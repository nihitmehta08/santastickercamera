<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Santa In Your House üéÖüì∏</title>
<style>
    body {
        background-color: #071123;
        color: white;
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 0;
        padding: 0;
    }

    #appBox {
        background: #0d1a33;
        padding: 25px;
        width: 350px;
        margin: 40px auto;
        border-radius: 12px;
        box-shadow: 0 0 15px rgba(255,255,255,0.1);
    }

    #previewCanvas {
        margin-top: 20px;
        max-width: 90%;
        border-radius: 10px;
    }

    .santaOption {
        width: 90px;
        cursor: pointer;
        margin: 10px;
        border-radius: 10px;
        border: 2px solid transparent;
    }

    .santaOption:hover {
        border-color: gold;
    }
</style>
</head>
<body>

<h1>Santa In Your House üéÖ‚ú®</h1>

<div id="appBox">
    <h3>1. Upload your house photo:</h3>
    <input type="file" id="houseUpload" accept="image/jpeg,image/png">

    <h3>2. Choose your Santa:</h3>
    <img src="santa3.png" class="santaOption" onclick="selectSanta('santa3.png')">
    <img src="santa4.png" class="santaOption" onclick="selectSanta('santa4.png')">

    <h3>Santa Size</h3>
    <input type="range" id="santaSize" min="40" max="200" value="100">

    <br><br>
    <button onclick="downloadImage()" 
            style="background: gold; padding: 12px 20px; border-radius: 8px; border: none; font-size: 16px;">
        Download Magic Photo ‚ú®
    </button>
</div>

<canvas id="previewCanvas"></canvas>

<script>
let houseImg = null;
let santaImg = new Image();

// Force only JPG or PNG uploads
document.getElementById("houseUpload").addEventListener("change", function (e) {
    const file = e.target.files[0];

    if (!file) return;

    if (!file.type.match("image/jpeg") && !file.type.match("image/png")) {
        alert("‚ùå Please upload a JPG or PNG file. HEIC is not supported.");
        e.target.value = "";
        return;
    }

    const reader = new FileReader();
    reader.onload = function () {
        houseImg = new Image();
        houseImg.onload = drawCanvas;
        houseImg.src = reader.result;
    };
    reader.readAsDataURL(file);
});

// Select Santa
function selectSanta(path) {
    santaImg = new Image();
    santaImg.onload = drawCanvas;
    santaImg.src = path;
}

// Draw everything on canvas
function drawCanvas() {
    if (!houseImg) return;

    const canvas = document.getElementById("previewCanvas");
    const ctx = canvas.getContext("2d");

    // AUTO-RESIZE IMAGE (max width 800)
    const maxWidth = 800;
    const scale = Math.min(maxWidth / houseImg.width, 1);

    canvas.width = houseImg.width * scale;
    canvas.height = houseImg.height * scale;

    ctx.drawImage(houseImg, 0, 0, canvas.width, canvas.height);

    if (santaImg.src) {
        const santaScale = document.getElementById("santaSize").value / 100;
        const santaWidth = santaImg.width * santaScale;
        const santaHeight = santaImg.height * santaScale;

        // Draw Santa at bottom-left
        ctx.drawImage(santaImg, 20, canvas.height - santaHeight - 20, santaWidth, santaHeight);
    }
}

// Download image
function downloadImage() {
    const canvas = document.getElementById("previewCanvas");
    const link = document.createElement("a");
    link.download = "SantaMagicPhoto.png";
    link.href = canvas.toDataURL();
    link.click();
}
</script>

</body>
</html>
